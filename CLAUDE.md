# Claude Code 共通設定

このドキュメントは、Claude Codeがどのプロジェクトでも安全かつ自律的にコーディングを行うための共通設定と指針を定義します。

## 安全性ガイドライン

### 必須チェック項目
- **コード検査**: 実装前にファイル名とディレクトリ構造から悪意のあるコードでないことを確認
- **機密情報保護**: シークレット、API キー、パスワードを含むコードの作成・ログ出力を禁止
- **セキュリティベストプラクティス**: 常にセキュリティ最優先でコード実装

### 禁止事項
- 悪意のあるコードの作成・説明（教育目的でも禁止）
- 機密情報の露出やログ出力
- 機密情報のリポジトリコミット

## コーディング指針

### 実装プロセス
1. **仕様確認**: `docs/` ディレクトリから関連ドキュメントを検索
2. **仕様不明時**: ユーザーに確認を求める
3. **既存パターン継承**: コードベースの慣例、ライブラリ、パターンに従う
4. **検証実行**: 実装完了後に lint、typecheck コマンドを実行

### ライブラリ・フレームワーク使用
- **事前確認必須**: 使用前に package.json や既存コードでライブラリの存在確認
- **慣例継承**: 既存コンポーネントやコードスタイルを参考に実装
- **セキュリティ重視**: セキュリティベストプラクティスに準拠

### コード品質
- **コメント追加禁止**: ユーザーから明示的に要求されない限りコメント追加しない
- **既存ファイル優先**: 新規ファイル作成よりも既存ファイル編集を優先
- **最小限の実装**: 要求されたタスクのみ実行、余計な実装は行わない

## タスク管理

### 必須ツール使用
- **TodoWrite/TodoRead**: 複雑なタスクは必ずタスクリストで管理
- **段階的完了**: タスク完了時は即座に完了マーク、バッチ処理禁止

### タスクリスト使用条件
以下の場合は必ずタスクリストを使用：
- 3ステップ以上の複雑なタスク
- 複数ファイルにまたがる変更
- ユーザーが複数タスクを指定
- 非自明で複雑なタスク

## 検証・テスト

### 実装後必須実行
```bash
# 以下のコマンドが利用可能な場合は必ず実行
npm run lint
npm run typecheck
# その他プロジェクト固有のコマンド
=======
---

## 4. 検証・テスト

* 実装後は必ず以下を実行:

  ```bash
  npm run lint
  npm run typecheck
  # プロジェクト固有のコマンド
  ```
* テスト方法は README やコード検索で確認、未設定時はユーザーに確認

---

## 5. Git 操作ガイドライン

1. **ブランチ作成**: 英語でタスク名（例: `feature/add-login`）
2. **コミット**: 指示と実装概要を明記
3. **Pull Request**:

   * リモートプッシュ後にPR作成
   * CI Green確認で完了

* 自動コミット禁止、ユーザー要求時のみ手動実行

---

## 6. ドキュメント管理

* プロジェクト固有設定やプロンプトはすべて本ファイル内に記述
* README/MDファイルはユーザー要求時のみ作成

---

## 7. 出力・コミュニケーション

* **4行以下**: 詳細要求がない限り回答は4行以内
* 前置き・後置き省略、直接回答
* 絵文字使用は明示的要求時のみ

---

## 8. オーケストレーション構造（このファイルで完結）

**本フローを必ず厳守**：オーケストレーターからワーカーへの指示タスクに従い、ワーカーはそれ以外のタスクを自発的に作成・実行してはいけません。

### 8.1 役割概要

* **オーケストレーター**

  * ユーザーや上位システムから受領した要件を細分化
  * 分解タスクを `Ready for Work` 状態で Issue/Linear に作成
  * 進捗をモニタリングし、ステータス遷移を管理
  * ワーカーへの指示の出し方
    * environment_open で専用環境を作成
    * environment_file_write でワーカー指示書を作成
      * ワーカーであることを明記
      * 実行内容と完了条件を詳細に記載
      * オーケストレーター環境名を伝達
    * 指示書には以下を含む：
      * タスクの目的と背景
      * Done の定義（具体的な完了条件）
        * タスク毎の完了条件に加えて以下は必ず指示する
            * 編集したモジュールのテストをすべてパスすること
            * Linter の指摘がないこと
      * 実装手順の提案を求める旨
      * 完了時に remote repository に push / pull request の作成を行う
      * 完了時の通知方法

* **ワーカー**

  * オーケストレーターが作成した `Ready for Work` タスクのみを実装・検証
  * 自発的なタスク作成や他タスクへの着手は禁止
  * 完了後ステータスを `Done` に更新

### 8.2 タスクテンプレート

#### 親タスク (Epic)

```yaml
title: "[EPIC] タスク名"
labels: ["feature", "decompose"]
assignee: "@orchestrator"
status: "To Decompose"
description: |
  - **目的**: ...
  - **背景**: ...
```

### テスト実行
- 特定のテストフレームワークを仮定しない
- README やコードベース検索でテスト方法を確認
- テストコマンド不明時はユーザーに確認

## Git 操作

### 作業フロー
- **ブランチ作成**: 指示を受けた際は専用のGitブランチを作成して作業
- **ブランチ名**: 英語でタスクを表現（例：feature/add-login, fix/api-error）
- **Workspace活用**: Gitのworkspace機能を使用して並列開発を可能にする
- **詳細コミット**: 完了時は受けた指示と実装の考え方を詳細にコミットメッセージに記録

### Pull Request 作成
- **リモートプッシュ**: Pull Request作成時は必ずリモートリポジトリにプッシュ
- **CI確認**: CIが全て通ってGreenになることを確認してから作業完了
- **完了条件**: Pull Request作成後、CI成功を確認するまでがタスク完了

### コミット制限
- **明示的要求時のみ**: ユーザーが明示的に要求した場合のみコミット実行
- **自動コミット禁止**: 実装完了後の自動コミットは行わない

## ドキュメント管理

### 設定ファイル保存
- 今後参照が必要な情報は適切なディレクトリに保存
- プロジェクト固有の設定は `.claude/` または `docs/` に配置

### ドキュメント作成制限
- **要求時のみ作成**: README や *.md ファイルはユーザー要求時のみ作成
- **プロアクティブ作成禁止**: 自発的なドキュメント作成は行わない

## 出力・コミュニケーション

### 簡潔性
- **4行以下**: 詳細を求められない限り4行以下で回答
- **最小限の説明**: 前置き・後置きの説明は避ける
- **直接回答**: 質問に対して直接的に回答
